version: '3'

services:

  mongo:
    image: mongo:3.6
    ports:
      - 27017:27017
    volumes:
      - ./tmp/db:/data/db  

  core:
    image: ghcr.io/democraciaenred/dialogo-legislativo-core:0.0.1
    environment:
      - PORT=3000
      - SESSION_SECRET=PleaseCreateASecretHERE
      - MONGO_URL=mongodb://mongo/dialogoLegislativo
      - AUTH_SERVER_URL=############TODO
      - AUTH_REALM=#################TODO
      - AUTH_CLIENT=################TODO
      - NOTIFIER_URL=http://notifier:3000/api
    ports:
      - "4000:3000"
    depends_on:
      - mongo
    links:
      - mongo:27017      
    tty: true

  web:
    image: ghcr.io/democraciaenred/dialogo-legislativo-web:0.0.1
    environment:
      - API_URL=http://localhost:4000
      - AUTH_SERVER_URL=############TODO
      - REALM=######################TODO
      - RESOURCE=###################TODO
      - SSL_REQUIRED=external
      - PUBLIC_CLIENT=true
      - CONFIDENTIAL_PORT=0
    ports:
      - "3000:3000"
    depends_on:
      - core
    links:
      - core      
    tty: true

  notifier:
    image: ghcr.io/democraciaenred/dialogo-legislativo-notifier:0.0.1
    environment:
      - PORT=3000
      - MONGO_URL=mongodb://mongo:27017
      - DB_COLLECTION=dialogoLegislativo
      - ORGANIZATION_EMAIL=##############TODO
      - ORGANIZATION_NAME=###############TODO
      - ORGANIZATION_API_URL=http://localhost:4000
      - NODEMAILER_HOST=##############TODO
      - NODEMAILER_PASS=##############TODO
      - NODEMAILER_USER=##############TODO
      - NODEMAILER_PORT=##############TODO
      - NODEMAILER_SECURE=true
      - NODE_ENV=development
      - BULK_EMAIL_CHUNK_SIZE=100
    ports:
      - "5000:3000"
    depends_on:
      - core
    tty: true

